<!DOCTYPE html>
{% extends "layout.html" %}
{% block title %}{{ name }}{% endblock %}
{% block head %}
    {{ super() }}
    <link type="text/css" rel="stylesheet" href="/static/css/userpage.css">
    <script type="text/javascript" src="{{ url_for("static", filename="up.js") }}"></script>
{% endblock %}
{% block main_row %}
    <div class="user-card">
        <div class="user-card-avatar-section">
            <div class="avatar-div">
                <img class="avatar" alt="User doesn't have avatar" src="{{ user.avatar }}">
            </div>
            <div class="user-card-nickname-section">
                <span class="user-nickname">{{ user.username }}</span>
                <span style="font-size: 0.8em">common user</span>
                {% if user.is_online %}
                    <span style="font-size: 0.8em; color: green">online</span>
                {% else %}
                    <span style="font-size: 0.8em">{{ user.last_time_online }}</span>
                {% endif %}
                <div class="user-card-other-block">
                    {% if name != current_user.username %}
                        <button class="tag-button-small" id="add_friend" value="Add friend">Add friend</button>
                        <button class="tag-button-small" id="remove_friend" value="">Remove friend</button>
                        <button class="tag-button-small" id="accept_request" value="">Accept request</button>
                        <button class="tag-button-small" id="decline_request" value="">Decline request</button>
                        <button class="tag-button-small" id="cancel_request" value="">Cancel request</button>
                    {% else %}
                        <span class="tag-button-small">change cover</span>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="user-card-description">
            <span style="color: var(--object-bg-text-color)">About me</span>
            <a class="user-description">{{ user.description }}</a>
        </div>
    </div>
    {% if not current_user.is_anonymous %}
        <button id="add_post" class="new-button" style="display: none">Add new post</button>
        <div class="create_post" id="create_post">
            <label class="create_post-label" for="user_post">Create new post</label>
            <textarea id="user_post"></textarea>
            {% if name == current_user.username %}
                <label for="view_level">Select post view level</label>
                <select class="post-button" name="view_level" id="view_level">
                    <option value="5">5 (For everyone)</option>
                    <option value="4">4</option>
                    <option value="3">3</option>
                    <option value="2">2</option>
                    <option value="1">1</option>
                    <option value="0">0 (Just for you)</option>
                </select>
            {% endif %}
            <button class="post-button" id="publish_post">Make post</button>
        </div>
    {% endif %}
    <span class="posts-span">Posts</span>
    <div class="posts">
        {% if posts %}
            {% for post in posts %}
                <div class="post">
                    <div class="post-header">
                        <img class="post-avatar" alt="User avatar" src="{{ get_user_avatar(post['user_id']) }}">
                        <a class="post-nick"
                           href="{{ url_for("users_page", name=get_username(post['user_id'])) }}"><b>{{ get_username(post['user_id']) }}</b></a>
                        <span class="post-date">posted at {{ formate_datetime(post['date_added']) }}</span><br>
                        {% if current_user.username == name %}
                            <div class="private-info">
                                {% if post['view_level'] > 4 %}
                                    <span class="tag-button-small">public</span>
                                {% else %}
                                    <span class="tag-button-small">private</span>
                                {% endif %}
                                <span class="private-role-info">only for: </span>
                                <span class="tag-button-small"
                                      style="background: #eca7a7">role: {{ post['view_level'] }}</span>
                            </div>
                        {% endif %}
                        <span class="material-icons" id="post-more">more_horiz</span>
                    </div>

                    <a class="post-message">{{ post['message'] }}</a>
                </div>
            {% endfor %}
        {% endif %}
    </div>
{% endblock %}
{% block right_row %}
    {{ super() }}
    {% block your_profile %}{% endblock %}
{% endblock %}
{% block scripts %}
    <script type="text/javascript">
        init("{{user['username']}}", "{{current_user.username}}");
        $("#add_friend").click(function () {
            add_friend('{{user['username']}}')
        })
        $("#cancel_request").click(function () {
            remove_friend('{{user['username']}}')
        })
        $("#accept_request").click(function () {
            accept_request('{{ user['username'] }}')
        })
        $("#decline_request").click(function () {
            remove_friend('{{ user['username'] }}')
        })
        $("#remove_friend").click(function () {
            remove_friend('{{ user['username'] }}')
        })
        $(function () {
            $("#publish_post").click(function () {
                {% if user.v_lvl == 0 %}
                    let view_lvl = document.getElementById("view_level").value
                    let whereid = null
                    let fromid = null
                {% else %}
                    let view_lvl = {{user.v_lvl}}
                        let whereid = "{{user.username}}"
                    let fromid = "{{current_user.username}}"
                {% endif %}
                publish_post($("#user_post").val(), null, view_lvl, whereid, fromid)
            })
        })
    </script>
{% endblock %}
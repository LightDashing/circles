<div class="chat-content" id="chat_content_{{ chat.id }}">
    <div class="chat-header">
        <h1>{{ chat.chatname }}</h1>
        {% if not chat.is_dialog %}
            <h3>{{ chat.rules }}</h3>
        {% endif %}
    </div>
    <div class="all_messages">
        <div id="incoming_msg_{{ chat.id }}" class="incoming_msg" data-id="{{ chat.id }}">
            {% if chat.is_dialog %}
                {% for message in messages %}
                    {% if message.from_user_id == current_user.id %}
                        <div class='message-box' style="align-self: end; background: #e3e4f8">
                    {% else %}
                        <div class='message-box'>
                    {% endif %}
                <div class="message-box-text">
                    <span class="message-text">{{ message.message }}</span>
                </div>
                {% if message.attachment %}
                    <span class="flex-break"></span>
                    <div class="message-pinned-images">
                        {% for attach in message.attachment %}
                            {% for image in attach.links_array %}
                                {% if image %}
                                    <img src="{{ image }}" class="post-pinned-image" alt="attach_img"
                                         onclick="showModalImage('image_modal', 'image_modal_content',
                                                 '{{ format_backslash(image) }}', 'image_modal_content',
                                                 '{{ attach.date_added }}', '{{ get_username(message.from_user_id) }}',
                                                 '{{ format_backslash(message.user_avatar) }}')">
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    </div>
                {% endif %}

                </div>
                {% endfor %}
            {% else %}
                {% for message in messages %}
                    {% if message.from_user_id == current_user.id %}
                        <div class='message-box' style="align-self: end; background: #e3e4f8">
                    {% else %}
                        <div class='message-box'>
                    {% endif %}
                <img src="{{ message.user_avatar }}" class="message-box-avatar">
                <div class="message-box-text">
                    <span class="from-user">{{ get_username(message.from_user_id) }}</span>
                    <span class="message-text">{{ message.message }}</span>
                </div>
                {#                        TODO: картинки занимают лишнее место, исправить#}
                {% if message.attachment %}
                    <span class="flex-break"></span>
                    <div class="message-pinned-images">
                        {% for attach in message.attachment %}
                            {% for image in attach.links_array %}
                                {% if image %}
                                    <img src="{{ image }}" class="post-pinned-image" alt="attach_img"
                                         onclick="showModalImage('image_modal', 'image_modal_content',
                                                 '{{ format_backslash(image) }}', 'image_modal_content',
                                                 '{{ attach.date_added }}', '{{ get_username(message.from_user_id) }}',
                                                 '{{ format_backslash(message.user_avatar) }}')">
                                {% endif %}
                            {% endfor %}
                        {% endfor %}
                    </div>
                {% endif %}

                </div>
                {% endfor %}
            {% endif %}
            </div>
            <div class="message-input">
                <label class="message-input-label">
                    <textarea id="message_{{ chat.id }}"></textarea>
                    <button class="new-button" style="margin: 0" id="send_message_{{ chat.id }}">Send</button>
                </label>
                <div class="message-input-pinned" id="pinned-container">

                </div>
                <script>
                    {% if messages %}
                        {% set l_item = messages|last %}
                        {% set f_item = messages|first%}
                        last_msg_time = "{{l_item.message_date}}"
                        first_msg_time = "{{f_item.message_date}}"
                        chat_id = {{ chat.id }}
                            {% else %}
                            last_msg_time = "{{ get_current_datetime() }}"
                        chat_id = {{ chat.id }}
                    {% endif %}
                </script>